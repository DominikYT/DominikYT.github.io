<!DOCTYPE html>
<html>
<head>
  <title>Login</title>
</head>
<body>
<h1>Login / Registration</h1>

<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="register()">Register</button>
<button onclick="login()">Login</button>
<button onclick="loginGoogle()">Login with Google</button>

<p id="status"></p>

<script type="module">
import { auth, provider } from './firebase.js';
import { createUserWithEmailAndPassword, signInWithEmailAndPassword, signInWithPopup, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

const status = document.getElementById('status');

window.register = () => {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  createUserWithEmailAndPassword(auth, email, password)
    .then(userCredential => {
      const user = userCredential.user;
      sendEmailVerification(user)
        .then(() => status.textContent = "Registered! Please check your email for verification link.");
    })
    .catch(err => status.textContent = err.message);
}

window.login = () => {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  signInWithEmailAndPassword(auth, email, password)
    .then(userCredential => {
      const user = userCredential.user;
      if(user.emailVerified){
        status.textContent = "Logged in successfully!";
      } else {
        status.textContent = "Please verify your email before logging in.";
        auth.signOut();
      }
    })
    .catch(err => status.textContent = err.message);
}

window.loginGoogle = () => {
  signInWithPopup(auth, provider)
    .then(() => { status.textContent = "Logged in with Google!"; })
    .catch(err => status.textContent = err.message);
}
</script>
</body>
</html>
