<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Phone Login (Firebase)</title>
  <style>
    body { font-family: Arial; max-width:600px; margin:30px auto; padding:0 16px; }
    input, button { padding:8px; margin:6px 0; width:100%; box-sizing:border-box; }
    #status { margin-top:10px; color:#222; }
  </style>
</head>
<body>

<h1>Phone Login (Firebase)</h1>

<p>Use test number configured in Firebase Console (Authentication → Sign-in method → Phone → Phone numbers for testing).</p>

<label>Phone number</label>
<input id="phoneNumber" type="tel" placeholder="+48123456789">

<div id="recaptcha-container"></div>

<button id="sendCodeBtn">Send Verification Code</button>

<label>Verification Code</label>
<input id="verificationCode" type="text" placeholder="Enter code">

<button id="verifyCodeBtn">Verify Code</button>

<p id="status"></p>

<script type="module">
import { auth } from './firebase.js';
import { RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

const phoneInput = document.getElementById('phoneNumber');
const codeInput = document.getElementById('verificationCode');
const sendBtn = document.getElementById('sendCodeBtn');
const verifyBtn = document.getElementById('verifyCodeBtn');
const statusEl = document.getElementById('status');

let confirmationResult = null;

// Initialize reCAPTCHA after auth is imported
window.recaptchaVerifier = new RecaptchaVerifier('recaptcha-container', {
  'size': 'normal',
  'callback': () => { console.log('reCAPTCHA solved'); },
  'expired-callback': () => { statusEl.textContent = 'reCAPTCHA expired. Solve it again.'; }
}, auth);

// Send SMS code
sendBtn.addEventListener('click', async () => {
  const phoneNumber = phoneInput.value.trim();
  if (!phoneNumber) { statusEl.textContent = 'Enter phone number'; return; }

  statusEl.textContent = 'Sending code...';
  try {
    confirmationResult = await signInWithPhoneNumber(auth, phoneNumber, window.recaptchaVerifier);
    statusEl.textContent = 'Code sent! Use test code if configured.';
  } catch (err) {
    statusEl.textContent = 'Error sending code: ' + err.message;
    console.error(err);
  }
});

// Verify SMS code
verifyBtn.addEventListener('click', async () => {
  const code = codeInput.value.trim();
  if (!confirmationResult) { statusEl.textContent = 'Request code first'; return; }

  statusEl.textContent = 'Verifying...';
  try {
    const result = await confirmationResult.confirm(code);
    const user = result.user;
    statusEl.textContent = `Phone verified! UID: ${user.uid}`;
  } catch (err) {
    statusEl.textContent = 'Error verifying code: ' + err.message;
    console.error(err);
  }
});
</script>
</body>
</html>
