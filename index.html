<!DOCTYPE html>
<html>
<head>
  <title>Phone Login</title>
</head>
<body>
<h1>Login / Phone Verification</h1>

<input id="phoneNumber" placeholder="+48123456789">
<div id="recaptcha-container"></div>
<button id="sendCodeBtn">Send Verification Code</button>

<input id="verificationCode" placeholder="Enter code">
<button id="verifyCodeBtn">Verify Code</button>

<p id="status"></p>

<script type="module">
import { auth } from './firebase.js';
import { RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

const status = document.getElementById('status');
const sendCodeBtn = document.getElementById('sendCodeBtn');
const verifyCodeBtn = document.getElementById('verifyCodeBtn');

let confirmationResult;

// Initialize reCAPTCHA
window.recaptchaVerifier = new RecaptchaVerifier('recaptcha-container', {
  'size': 'normal',
  'callback': (response) => {
    console.log('reCAPTCHA solved');
  }
}, auth);

// Send verification code via SMS
sendCodeBtn.addEventListener('click', () => {
  const phoneNumber = document.getElementById('phoneNumber').value;
  signInWithPhoneNumber(auth, phoneNumber, window.recaptchaVerifier)
    .then(result => {
      confirmationResult = result;
      status.textContent = "Code sent! Check your phone.";
    })
    .catch(err => status.textContent = err.message);
});

// Verify code
verifyCodeBtn.addEventListener('click', () => {
  const code = document.getElementById('verificationCode').value;
  confirmationResult.confirm(code)
    .then(result => {
      const user = result.user;
      status.textContent = `Phone verified! User UID: ${user.uid}`;
    })
    .catch(err => status.textContent = err.message);
});
</script>
</body>
</html>
