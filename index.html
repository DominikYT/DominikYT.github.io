<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Email Login & Registration</title>
<style>
  body { font-family: Arial; max-width:500px; margin:30px auto; padding:0 16px; }
  input, button { padding:8px; margin:6px 0; width:100%; box-sizing:border-box; }
  #status { margin-top:10px; color:#222; }
</style>
</head>
<body>

<h1>Email Registration & Login</h1>

<label>Email:</label>
<input id="email" type="email" placeholder="Enter email">

<label>Password:</label>
<input id="password" type="password" placeholder="Enter password">

<button id="registerBtn">Register</button>
<button id="loginBtn">Login</button>

<p id="status"></p>

<script type="module">
import { auth } from './firebase.js';
import { createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const registerBtn = document.getElementById('registerBtn');
const loginBtn = document.getElementById('loginBtn');
const statusEl = document.getElementById('status');

// Funkcja do maskowania emaila dla komunikatu
function maskEmail(email) {
  const [name, domain] = email.split("@");
  if (name.length <= 1) return "*" + "@" + domain;
  return name[0] + "*".repeat(name.length-1) + "@" + domain;
}

// Register
registerBtn.addEventListener('click', async () => {
  const email = emailInput.value.trim();
  const password = passwordInput.value.trim();
  if (!email || !password) { statusEl.textContent = 'Enter email and password'; return; }

  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    await sendEmailVerification(userCredential.user);
    statusEl.textContent = `Registered! Verification email sent to ${maskEmail(email)}. Check your inbox.`;
  } catch(err) {
    statusEl.textContent = 'Error: ' + err.message;
    console.error(err);
  }
});

// Login
loginBtn.addEventListener('click', async () => {
  const email = emailInput.value.trim();
  const password = passwordInput.value.trim();
  if (!email || !password) { statusEl.textContent = 'Enter email and password'; return; }

  try {
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    if (user.emailVerified) {
      statusEl.textContent = 'Logged in successfully!';
    } else {
      statusEl.textContent = `Please verify your email. We sent a verification code to ${maskEmail(email)}.`;
    }
  } catch(err) {
    statusEl.textContent = 'Error: ' + err.message;
    console.error(err);
  }
});
</script>
</body>
</html>
